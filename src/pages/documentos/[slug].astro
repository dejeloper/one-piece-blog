---
import Layout from "../../layouts/Layout.astro";
import { getAllPostsSlugs, getPostsInfo } from "../../lib/wp";

const slug = Astro.params.slug;
if (!slug) {
  throw new Error("Slug is required");
}

const {
  title,
  date,
  content,
  excerpt,
  featuredImage,
  alt_text_image,
  authorName,
  authorAvatar,
  authorDescription,
} = await getPostsInfo(slug);

export async function getStaticPaths() {
  const slugs: string[] = await getAllPostsSlugs();
  return slugs.map((slug: string) => ({ params: { slug } }));
}

const dateFormatted = new Date(date).toLocaleDateString("es-ES", {
  year: "numeric",
  month: "long",
  day: "numeric",
});
---

<Layout
  title={`${title} - Documentos`}
  description={excerpt ||
    "Documento del blog Mi Propio One Piece. Recursos y material de referencia."}
>
  <!-- Barra superior estilo plataforma -->
  <div
    class="sticky top-0 z-10 bg-white/80 backdrop-blur-md border-b border-gray-200/50"
  >
    <div class="max-w-4xl mx-auto px-4 py-3 flex items-center justify-between">
      <div class="flex items-center space-x-3">
        <a
          href="/documentos"
          class="flex items-center text-gray-600 hover:text-gray-900 transition-colors"
        >
          <svg
            class="w-4 h-4 mr-2"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M15 19l-7-7 7-7"></path>
          </svg>
          Documentos
        </a>
        <span class="text-gray-400">/</span>
        <span class="text-gray-900 font-medium truncate max-w-md">{title}</span>
      </div>
      <div class="flex items-center space-x-2 text-sm text-gray-500 gap-x-2">
        <svg
          class="w-4 h-4"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"
          ></path>
        </svg>
        {dateFormatted}
      </div>
    </div>
  </div>

  <main class="min-h-screen bg-gray-50/30">
    <!-- Contenedor principal estilo ChatGPT -->
    <div class="max-w-4xl mx-auto px-4 py-8">
      <!-- Header del documento -->
      <div
        class="bg-white rounded-lg shadow-sm border border-gray-200/50 p-8 mb-6"
      >
        <!-- Icono y tipo de documento -->
        <div class="flex items-center mb-4">
          <div
            class="w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center mr-3"
          >
            <svg
              class="w-4 h-4 text-blue-600"
              fill="currentColor"
              viewBox="0 0 20 20"
            >
              <path
                fill-rule="evenodd"
                d="M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4zm2 6a1 1 0 011-1h6a1 1 0 110 2H7a1 1 0 01-1-1zm1 3a1 1 0 100 2h6a1 1 0 100-2H7z"
                clip-rule="evenodd"></path>
            </svg>
          </div>
          <span
            class="text-sm font-medium text-gray-600 bg-gray-100 px-3 py-1 rounded-full"
          >
            Documento
          </span>
        </div>

        <!-- Título principal -->
        <h1
          class="text-3xl font-semibold text-gray-900 leading-tight mb-4 tracking-tight"
        >
          {title}
        </h1>

        <!-- Metadata -->
        <div
          class="flex items-center space-x-6 text-sm text-gray-500 border-t border-gray-100 pt-4"
        >
          <div class="flex items-center">
            <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20">
              <path
                fill-rule="evenodd"
                d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z"
                clip-rule="evenodd"></path>
            </svg>
            {authorName}
          </div>
          <div class="flex items-center">
            <svg
              class="w-4 h-4 mr-2"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
            Actualizado {dateFormatted}
          </div>
        </div>
      </div>

      <!-- Contenido del documento -->
      <div
        class="bg-white rounded-lg shadow-sm border border-gray-200/50 overflow-hidden"
      >
        <!-- Imagen destacada si existe -->
        {
          featuredImage && (
            <div class="px-8 pt-8">
              <img
                src={featuredImage}
                alt={alt_text_image}
                title={alt_text_image}
                class="w-full h-auto object-cover rounded-lg border border-gray-200"
                loading="lazy"
              />
              {excerpt && (
                <p class="mt-3 text-sm text-gray-600 italic text-center border-b border-gray-100 pb-6">
                  {excerpt}
                </p>
              )}
            </div>
          )
        }

        <!-- Contenido principal -->
        <div class="px-8 py-8">
          <div
            class="prose prose-gray max-w-none
                   prose-headings:text-gray-900 prose-headings:font-semibold prose-headings:tracking-tight
                   prose-p:text-gray-700 prose-p:leading-relaxed prose-p:text-[15px]
                   prose-a:text-blue-600 prose-a:no-underline hover:prose-a:underline
                   prose-strong:text-gray-900 prose-strong:font-semibold
                   prose-ul:text-gray-700 prose-ol:text-gray-700
                   prose-li:text-[15px] prose-li:leading-relaxed
                   prose-blockquote:border-l-blue-500 prose-blockquote:bg-blue-50/50 prose-blockquote:py-4 prose-blockquote:px-6 prose-blockquote:rounded-r-lg prose-blockquote:not-italic
                   prose-code:bg-gray-100 prose-code:text-gray-800 prose-code:px-2 prose-code:py-1 prose-code:rounded prose-code:text-sm prose-code:font-mono
                   prose-pre:bg-gray-900 prose-pre:text-gray-100"
            set:html={content}
          />
        </div>
      </div>

      <!-- Footer con información del autor -->
      <div
        class="bg-white rounded-lg shadow-sm border border-gray-200/50 p-6 mt-6"
      >
        <div class="flex items-start space-x-4">
          <img
            class="w-12 h-12 rounded-full object-cover border-2 border-gray-100"
            src={authorAvatar}
            alt={authorName}
            loading="lazy"
          />
          <div class="flex-1">
            <h3 class="font-semibold text-gray-900 text-sm">{authorName}</h3>
            <p class="text-gray-600 text-sm mt-1 leading-relaxed">
              {authorDescription}
            </p>
          </div>
        </div>
      </div>

      <!-- Navegación inferior -->
      <div
        class="flex justify-between items-center mt-8 pt-6 border-t border-gray-200"
      >
        <a
          href="/documentos"
          class="inline-flex items-center px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 hover:text-gray-900 transition-colors"
        >
          <svg
            class="w-4 h-4 mr-2"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M15 19l-7-7 7-7"></path>
          </svg>
          Volver a documentos
        </a>

        <div class="flex items-center text-sm text-gray-500">
          <span>Documento • {dateFormatted}</span>
        </div>
      </div>
    </div>
  </main>
</Layout>

<style>
  /* Fuente más parecida a ChatGPT */
  body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
      "Helvetica Neue", Arial, sans-serif;
  }

  /* Mejoras en la tipografía */
  .prose {
    font-family: inherit;
    line-height: 1.6;
  }

  .prose h1,
  .prose h2,
  .prose h3,
  .prose h4,
  .prose h5,
  .prose h6 {
    margin-top: 2em;
    margin-bottom: 1em;
    font-weight: 600;
  }

  .prose h1 {
    font-size: 1.875rem;
    line-height: 1.2;
  }

  .prose h2 {
    font-size: 1.5rem;
    line-height: 1.3;
  }

  .prose h3 {
    font-size: 1.25rem;
    line-height: 1.4;
  }

  .prose p {
    margin-bottom: 1.25em;
  }

  .prose ul,
  .prose ol {
    margin: 1.25em 0;
  }

  .prose li {
    margin: 0.5em 0;
  }

  /* Código más estilizado */
  .prose code {
    font-family: "JetBrains Mono", "Fira Code", "Monaco", "Cascadia Code",
      "Roboto Mono", monospace;
    font-size: 0.875em;
  }

  .prose pre {
    font-family: "JetBrains Mono", "Fira Code", "Monaco", "Cascadia Code",
      "Roboto Mono", monospace;
    font-size: 0.875rem;
    line-height: 1.5;
    padding: 1.5rem;
    border-radius: 0.75rem;
  }
</style>
