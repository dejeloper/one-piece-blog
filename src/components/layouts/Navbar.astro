---
const navLinks = [
  { href: "/", label: "Inicio" },
  { href: "/chapters", label: "Todos los capítulos" },
  // { href: "#curiosities", label: "Curiosidades" },
  { href: "/#author", label: "Sobre el autor" },
  // { href: "#contact", label: "Contacto" },
];

const { name, icon } = Astro.props;
---

<nav
  class="sticky top-0 z-50 bg-[var(--background)]/95 backdrop-blur-md border-b border-[var(--border)] shadow-sm"
>
  <div class="container mx-auto px-4 py-4 flex items-center justify-between">
    <!-- Logo -->
    <div class="flex items-center space-x-2 z-60">
      <a href="/" data-astro-prefetch>
        <span class="text-2xl font-bold text-[var(--primary)]">{icon}</span>
        <span class="text-xl font-semibold tracking-wide">{name}</span>
      </a>
    </div>

    <!-- Menú escritorio -->
    <ul class="hidden md:flex space-x-4 text-[var(--primary)] font-medium">
      {
        navLinks.map((link) => (
          <li>
            <a
              href={link.href}
              data-astro-prefetch
              class="px-3 py-2 rounded-md hover:bg-[var(--accent)]/20 hover:text-[var(--accent)] transition active:scale-95"
            >
              {link.label}
            </a>
          </li>
        ))
      }
    </ul>

    <!-- Botón hamburguesa móvil -->
    <button
      id="menu-btn"
      class="md:hidden text-3xl focus:outline-none text-[var(--primary)] bg-transparent z-60"
    >
      ☰
    </button>
  </div>

  <!-- Overlay -->
  <div
    id="overlay"
    class="fixed w-full min-h-screen inset-0 mt-[64px] bg-black/50 opacity-0 hidden z-20 transition-opacity duration-300"
  >
  </div>

  <!-- Menú móvil -->
  <div
    id="mobile-menu"
    class="fixed top-0 right-0 h-full w-full bg-[var(--background)] text-[var(--primary)] font-medium transform translate-x-full hidden transition-transform duration-400 z-50"
  >
    <ul
      class="flex flex-col space-y-4 p-6 mt-[64px] z-100 bg-[var(--background)] border-t border-[var(--border)]"
    >
      {
        navLinks.map((link) => (
          <li>
            <a
              href={link.href}
              data-astro-prefetch
              class="block px-3 py-2 rounded-md hover:bg-[var(--accent)]/20 hover:text-[var(--accent)] transition active:scale-95"
            >
              {link.label}
            </a>
          </li>
        ))
      }
    </ul>
  </div>
</nav>

<script>
  function initMenu() {
    const btn = document.getElementById("menu-btn");
    const menu = document.getElementById("mobile-menu");
    const overlay = document.getElementById("overlay");

    if (!btn || !menu || !overlay) return;

    const toggleMenu = () => {
      const isMenuOpen = !menu.classList.contains("translate-x-full");

      if (isMenuOpen) {
        // Cerrar menú
        menu.classList.add("translate-x-full");
        overlay.classList.remove("opacity-100");
        overlay.classList.add("opacity-0");

        setTimeout(() => {
          menu.classList.add("hidden");
          overlay.classList.add("hidden");
        }, 400);
      } else {
        // Abrir menú
        menu.classList.remove("hidden");
        overlay.classList.remove("hidden");

        requestAnimationFrame(() => {
          menu.classList.remove("translate-x-full");
          overlay.classList.remove("opacity-0");
          overlay.classList.add("opacity-100");
        });
      }
    };

    btn.addEventListener("click", toggleMenu);
    overlay.addEventListener("click", toggleMenu);
  }

  // Inicializar al cargar la página
  document.addEventListener("DOMContentLoaded", initMenu);

  // Re-inicializar después de cada navegación con view transitions
  document.addEventListener("astro:page-load", initMenu);
</script>
